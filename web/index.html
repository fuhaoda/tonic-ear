<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tonic Ear</title>
    <link rel="stylesheet" href="/assets/styles.css" />
  </head>
  <body>
    <div class="bg-shape bg-shape-a"></div>
    <div class="bg-shape bg-shape-b"></div>

    <header class="app-header">
      <div class="app-header-inner">
        <div>
          <h1>Tonic Ear</h1>
          <p>Progressive ear training for pitch and scale recognition.</p>
        </div>
        <button id="headerHomeBtn" class="btn btn-ghost" type="button">Home</button>
      </div>
    </header>

    <main class="app-shell">
      <p id="globalError" class="global-error hidden"></p>

      <section id="dashboardView" class="view active">
        <div class="panel settings-panel">
          <h2>Training Settings</h2>
          <div class="settings-grid">
            <label>
              Instrument
              <select id="instrumentSelect"></select>
            </label>
            <label>
              Gender
              <select id="genderSelect"></select>
            </label>
            <label>
              Key
              <select id="keySelect"></select>
            </label>
            <label>
              Temperament
              <select id="temperamentSelect"></select>
            </label>
            <label class="checkbox-line">
              <input id="showVisualHints" type="checkbox" />
              Show visual pitch hints (comparison and sorting only)
            </label>
          </div>
          <button id="resetProgressBtn" class="btn btn-ghost" type="button">Reset local progress</button>
        </div>

        <div id="audioDebugPanel" class="panel hidden">
          <div class="panel-title-row">
            <h2>Audio Debug</h2>
            <span class="chip">iPhone diagnostics</span>
          </div>
          <p id="audioDebugStatus" class="subtle">Audio debug disabled.</p>
          <div class="button-row">
            <button id="audioDebugUnlockBtn" class="btn" type="button">Unlock Audio</button>
            <button id="audioDebugWebToneBtn" class="btn" type="button">Test WebAudio 880Hz</button>
            <button id="audioDebugSampleBtn" class="btn" type="button">Test Sample m069</button>
          </div>
          <pre id="audioDebugLog" class="audio-debug-log" aria-live="polite"></pre>
        </div>

        <div class="panel">
          <div class="panel-title-row">
            <h2>Module List</h2>
            <span class="chip">20 questions each</span>
          </div>
          <div id="moduleGrid" class="module-grid"></div>
        </div>

        <div class="panel">
          <h2>Recent Results</h2>
          <div id="historyList" class="history-list"></div>
        </div>
      </section>

      <section id="quizView" class="view hidden">
        <div class="panel quiz-panel">
          <div class="quiz-top-row">
            <div>
              <p id="quizModuleTitle" class="module-title"></p>
              <p id="quizProgress" class="subtle"></p>
            </div>
            <button id="backToDashboardBtn" class="btn btn-ghost" type="button">Exit Session</button>
          </div>

          <h2 id="promptText"></h2>

          <label class="checkbox-line quiz-visual-toggle">
            <input id="quizShowVisualHints" type="checkbox" />
            Show visual pitch hints
          </label>

          <div id="visualHintContainer" class="visual-hint-container"></div>

          <div class="playback-controls">
            <div class="playback-buttons">
              <button id="repeatBtn" class="btn" type="button">Repeat</button>
              <button id="showAnswerBtn" class="btn btn-ghost hidden" type="button">Show Answer</button>
            </div>
            <span class="subtle">Auto-played once. Repeat any time.</span>
          </div>

          <div id="answerArea" class="answer-area"></div>

          <div class="quiz-status-block">
            <p id="feedbackText" class="feedback is-empty" aria-live="polite">&nbsp;</p>
            <div class="quiz-footer-row">
              <button id="nextBtn" class="btn btn-primary" type="button" disabled>Next</button>
            </div>
          </div>
        </div>
      </section>

      <section id="resultView" class="view hidden">
        <div class="panel">
          <h2>Session Result</h2>
          <p id="scoreLine" class="score-line"></p>
          <p id="scoreDetail" class="subtle"></p>
          <div class="result-actions">
            <button id="backToHomeBtn" class="btn" type="button">Back to Dashboard</button>
            <button id="retryModuleBtn" class="btn btn-primary" type="button">Retry Same Module</button>
          </div>
        </div>

        <div class="panel">
          <h2>Mistakes Replay</h2>
          <div id="mistakeList" class="mistake-list"></div>
        </div>
      </section>
    </main>

    <section class="touch-keyboard-panel" id="touchKeyboardPanel" aria-label="Touch keyboard">
      <div class="touch-keyboard-top">
        <p id="touchKeyboardHint" class="subtle">Tap 1-7 to play one-shot notes</p>
        <button id="openFullKeyboardBtn" class="btn touch-full-toggle" type="button">Full Keyboard</button>
      </div>
      <div class="touch-keyboard-buttons" id="touchKeyboardButtons">
        <button class="btn touch-key" type="button" data-degree="1">1</button>
        <button class="btn touch-key" type="button" data-degree="2">2</button>
        <button class="btn touch-key" type="button" data-degree="3">3</button>
        <button class="btn touch-key" type="button" data-degree="4">4</button>
        <button class="btn touch-key" type="button" data-degree="5">5</button>
        <button class="btn touch-key" type="button" data-degree="6">6</button>
        <button class="btn touch-key" type="button" data-degree="7">7</button>
      </div>
    </section>

    <section id="fullKeyboardOverlay" class="full-keyboard-overlay hidden" aria-label="Full keyboard mode">
      <div class="full-keyboard-shell">
        <div class="full-keyboard-controls">
          <p class="subtle full-keyboard-exit-hint">Hold Oct+ and Oct- to return</p>
          <button
            id="fullKeyboardOctUp"
            class="btn full-octave-key"
            type="button"
            data-octave-shift="1"
            aria-label="Octave up"
          >
            Oct +
          </button>
          <button
            id="fullKeyboardOctDown"
            class="btn full-octave-key"
            type="button"
            data-octave-shift="-1"
            aria-label="Octave down"
          >
            Oct -
          </button>
        </div>
        <div id="fullKeyboardButtons" class="full-keyboard-rows" aria-label="Full keyboard buttons">
          <div class="full-keyboard-row full-keyboard-row-top">
            <button class="btn touch-key full-touch-key" type="button" data-full-degree="7">7</button>
          </div>
          <div class="full-keyboard-row">
            <button class="btn touch-key full-touch-key" type="button" data-full-degree="4">4</button>
            <button class="btn touch-key full-touch-key" type="button" data-full-degree="5">5</button>
            <button class="btn touch-key full-touch-key" type="button" data-full-degree="6">6</button>
          </div>
          <div class="full-keyboard-row">
            <button class="btn touch-key full-touch-key" type="button" data-full-degree="1">1</button>
            <button class="btn touch-key full-touch-key" type="button" data-full-degree="2">2</button>
            <button class="btn touch-key full-touch-key" type="button" data-full-degree="3">3</button>
          </div>
        </div>
      </div>
    </section>

    <script type="module" src="/assets/app.js"></script>
  </body>
</html>
